import { Controller, Get, Query, UseGuards } from '@nestjs/common';
import { ReportService } from '../services/report.service';
import { JwtAuthGuard } from '../../auth/guards/jwt-auth.guard';
import { RolesGuard } from '../../auth/guards/roles.guard';
import { Roles } from '../../auth/decorators/roles.decorator';
import { ReportFilterDto } from '../dtos/report-filter.dto';
import { ApiTags, ApiBearerAuth, ApiOperation, ApiQuery } from '@nestjs/swagger';

@ApiTags('Admin')
@ApiBearerAuth()
@UseGuards(JwtAuthGuard, RolesGuard)
@Roles('admin')
@Controller('admin/reports')
export class ReportController {
  constructor(private readonly reportService: ReportService) {}

  @Get()
  @ApiOperation({ summary: 'Generate system reports' })
  @ApiQuery({ name: 'period', required: false, enum: ['week', 'month', 'year'] })
  generate(@Query() filter: ReportFilterDto) {
    return this.reportService.generateReport(filter);
  }
} 